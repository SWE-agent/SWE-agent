#!/root/python3.11/bin/python3
from __future__ import annotations

import os
import sys
from pathlib import Path

from argparse import ArgumentParser

lib_path = os.path.join(os.path.dirname(os.path.dirname(os.path.abspath(__file__))), 'lib')
sys.path.insert(0, lib_path)

from sweer_config import ClientConfig
from sweer_utils import ScreenshotMode, _print_response_with_metadata, _autosave_screenshot_from_response, _print_error, send_request

config = ClientConfig()


def keypress(keys):
    """Press the specified keys. Keys should be a JSON string like '["ctrl", "c"]'."""
    import json
    try:
        keys_data = json.loads(keys)
    except json.JSONDecodeError:
        _print_error("Keys must be valid JSON")
        return
    response = send_request(config.port, 
        "keypress", "POST", {"keys": keys_data, "return_screenshot": config.autoscreenshot},
    )
    if response is None:
        return
    _print_response_with_metadata(response)
    _autosave_screenshot_from_response(response, config.screenshot_mode)


if __name__ == "__main__":
    parser = ArgumentParser()
    parser.add_argument(
        "keys",
        type=str,
        help="The keys to press (JSON string like '[\"ctrl\", \"c\"]')",
    )
    args = parser.parse_args()
    keypress(args.keys)

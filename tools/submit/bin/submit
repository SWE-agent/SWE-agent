main() {
    cd $ROOT

    # Check if the patch file exists and is non-empty
    if [ -s "$ENV_DIR/test.patch" ]; then
        # Apply the patch in reverse
        git apply -R < "$ENV_DIR/test.patch"
    fi

    git add -A
    git diff --cached > $ENV_DIR/model.patch
    echo "<<SWE_AGENT_SUBMISSION>>"
    cat $ENV_DIR/model.patch
    echo "<<SWE_AGENT_SUBMISSION>>"
}

main "$@"
